<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Details | Skill Bridge</title>
    <link rel="stylesheet" href="css/style22.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .event-details-container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 30px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .event-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .event-title {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .event-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
            color: #666;
        }

        .event-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .event-description {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #444;
            margin-bottom: 30px;
        }

        .event-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: #217dbb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
        }

        .event-details-section {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #eee;
        }

        .event-details-section h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .event-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .event-detail-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .event-detail-card h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <a href="index.html">
                    Skill<span class="logo-accent">Bridge</span>
                </a>
            </div>
            <div class="main-menu">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li class="dropdown">
                        <a href="#">Surfaces</a>
                        <div class="dropdown-content">
                            <a href="Skillswapsearchpage.html"><i class="fas fa-laptop"></i>Skill Swap</a>
                            <a href="online-tutorial request.html"><i class="fas fa-chalkboard-teacher"></i>Online Tutorial</a>
                            <a href="event.html"><i class="fas fa-calendar-alt"></i> Upcoming Events</a>
                        </div>
                    </li>
                    <li><a href="aboutus.html">About Us</a></li>
                    <li><a href="contactus.html">Contact Us</a></li>
                    <li><a href="signup.html" class="btn"><i class="fas fa-user"></i> Sign Up</a></li>
                    <li><a href="login.html" class="btn"><i class="fas fa-sign-in-alt"></i> Log In</a></li>
                </ul>
            </div>
            <button class="hamburger-button">
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
                <div class="hamburger-line"></div>
            </button>
            <div class="sidebar">
                <div class="sidebar-header">
                    <button type="button" class="close-sidebar">&times;</button>
                </div>
                <div class="sidebar-content">
                    <div class="menu-section">
                        <a href="profilepage.html"><i class="fas fa-user"></i> Personal Details</a>
                        <a href="payment.html"><i class="fas fa-crown"></i> Subscriptions</a>
                        <a href="Skillswapsearchpage.html"><i class="fas fa-exchange-alt"></i> Swap Skill</a>
                        <a href="chatspage.html"><i class="fas fa-envelope"></i> Messages</a>
                        <a href="online-tutorial request.html"><i class="fas fa-chalkboard-teacher"></i> Online Tutorial</a>
                        <a href="my-tutorials.html"><i class="fas fa-chalkboard-teacher"></i> My Tutorials</a>
                        <a href="event.html"><i class="fas fa-calendar-alt"></i> Upcoming Events</a>
                        <a href="my-events.html"><i class="fas fa-calendar-check"></i> My Events</a>
                        <a href="Skillswap.html" role="button"><i class="fas fa-history"></i> Skills SwapHistory</a>
                        <a href="settings.html"><i class="fas fa-cog"></i> Settings</a>
                    </div>
                    <div class="sidebar-section-title">Privacy Policy-Terms of Service</div>
                    <div class="menu-section support-section">
                        <a href="#" role="button"><i class="fas fa-question-circle"></i> Help & Feedback</a>
                        <a href="login.html" class="login-btn"><i class="fas fa-sign-in-alt"></i> Log In</a>
                        <a href="signup.html" class="signup-btn"><i class="fas fa-user-plus"></i> Sign Up</a>
                        <a href="#" class="signout-btn" style="display: none;"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Event Details Content -->
    <main class="event-details-container">
        <div class="event-header">
            <h1 class="event-title" id="eventTitle">Loading...</h1>
            <div class="event-meta">
                <div class="event-meta-item">
                    <i class="fas fa-calendar"></i>
                    <span id="eventDate">Loading...</span>
                </div>
                <div class="event-meta-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span id="eventLocation">Loading...</span>
                </div>
                <div class="event-meta-item">
                    <i class="fas fa-clock"></i>
                    <span id="eventTime">Loading...</span>
                </div>
            </div>
        </div>

        <div class="event-description" id="eventDescription">
            Loading...
        </div>

        <div class="event-details-section">
            <h3>Event Details</h3>
            <div class="event-details-grid">
                <div class="event-detail-card">
                    <h4><i class="fas fa-users"></i> Capacity</h4>
                    <p id="eventCapacity">Loading...</p>
                </div>
                <div class="event-detail-card">
                    <h4><i class="fas fa-tag"></i> Category</h4>
                    <p id="eventCategory">Loading...</p>
                </div>
                <div class="event-detail-card">
                    <h4><i class="fas fa-user-tie"></i> Organizer</h4>
                    <p id="eventOrganizer">Loading...</p>
                </div>
            </div>
        </div>

        <div class="event-actions">
            <button class="btn btn-primary" id="joinEventBtn">
                <i class="fas fa-sign-in-alt"></i> Join Event
            </button>
            <button class="btn btn-secondary" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i> Back to Events
            </button>
        </div>
    </main>

    <script>
        // Get event ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');

        // Fetch event details
        async function loadEventDetails() {
            try {
                const response = await fetch(`http://localhost:5000/api/events/${eventId}`);
                if (!response.ok) {
                    throw new Error('Event not found');
                }
                const event = await response.json();
                
                // Update page content
                document.getElementById('eventTitle').textContent = event.title;
                document.getElementById('eventDate').textContent = new Date(event.date).toLocaleDateString();
                document.getElementById('eventLocation').textContent = event.location;
                document.getElementById('eventTime').textContent = event.time || 'TBA';
                document.getElementById('eventDescription').textContent = event.description;
                document.getElementById('eventCapacity').textContent = event.capacity || 'Unlimited';
                document.getElementById('eventCategory').textContent = event.category || 'General';
                document.getElementById('eventOrganizer').textContent = event.organizer || 'Skill Bridge Team';
            } catch (error) {
                console.error('Error loading event details:', error);
                alert('Failed to load event details. Please try again later.');
            }
        }

        // Handle join event
        document.getElementById('joinEventBtn').addEventListener('click', async function() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please log in to join this event');
                    window.location.href = 'login.html';
                    return;
                }

                const response = await fetch(`http://localhost:5000/api/events/${eventId}/join`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'Failed to join event');
                }

                // Show success message
                showToast('Successfully joined the event!', 'success');
                
                // Update button state
                this.innerHTML = '<i class="fas fa-check"></i> Joined';
                this.disabled = true;
                this.classList.add('joined');

                // Add a small delay before redirecting
                setTimeout(() => {
                    window.location.href = 'my-events.html';
                }, 1500);

            } catch (error) {
                console.error('Error joining event:', error);
                showToast(error.message || 'Failed to join event. Please try again later.', 'error');
            }
        });

        // Function to show toast messages
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(toast);

            // Add styles for toast
            const style = document.createElement('style');
            style.textContent = `
                .toast {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 25px;
                    border-radius: 8px;
                    background: white;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                    z-index: 1000;
                    animation: slideIn 0.3s ease-out;
                }
                .toast-success {
                    border-left: 4px solid #28a745;
                }
                .toast-error {
                    border-left: 4px solid #dc3545;
                }
                .toast-content {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }
                .toast-content i {
                    font-size: 1.2rem;
                }
                .toast-success i {
                    color: #28a745;
                }
                .toast-error i {
                    color: #dc3545;
                }
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            // Remove toast after 3 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Load event details when page loads
        document.addEventListener('DOMContentLoaded', loadEventDetails);
    </script>

    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/auth-init.js"></script>
    <script src="js/fixed_merged_main.js"></script>
</body>
</html> 